
<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¶ × ×’×Ÿ ×©×™×¨×™× ×œ×¨×›×‘ ğŸš—</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- ×× ×™×¢×ª ×›×™×‘×•×™ ××¡×š -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- ×”×’×“×¨×•×ª PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1db954">
    <link rel="apple-touch-icon" href="car-music-icon.png">
    <link rel="icon" type="image/png" href="car-music-icon.png">
    <!-- ××¤×©×¨ × ×™×’×•×Ÿ ×‘×¨×§×¢ -->
    <meta name="mobile-web-app-background-audio" content="yes">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            text-align: center;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0f0f1e 100%);
            color: white;
            margin: 0;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            font-size: 16px;
            overflow-x: hidden;
            position: relative;
        }
        
        /* ××¤×§×˜ ×¨×§×¢ ××•×–×¨ */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(29,185,84,0.1) 0%, transparent 70%);
            animation: pulse 15s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 0.3; }
            50% { transform: scale(1.1) rotate(180deg); opacity: 0.5; }
        }

        .music-player {
            width: 100%;
            max-width: 480px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            padding: 25px;
            border-radius: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 8px 32px 0 rgba(0, 0, 0, 0.37),
                inset 0 1px 0 0 rgba(255, 255, 255, 0.1),
                0 0 60px rgba(29, 185, 84, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 1;
            gap: 20px;
            animation: fadeInUp 0.6s ease-out;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .video-frame {
            width: 100%;
            height: 240px;
            border-radius: 20px;
            border: 1px solid rgba(29, 185, 84, 0.3);
            overflow: hidden;
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            box-shadow: 
                0 10px 40px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                0 0 30px rgba(29, 185, 84, 0.15);
            position: relative;
            transition: all 0.3s ease;
        }
        
        .video-frame:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 15px 50px rgba(0, 0, 0, 0.6),
                0 0 40px rgba(29, 185, 84, 0.25);
        }
        
        .video-frame iframe {
            width: 100% !important;
            height: 100% !important;
            display: block;
        }

        .control-buttons {
            display: flex !important;
            justify-content: center;
            gap: 5px;
            margin: 5px 0;
            width: 100%;
            flex-wrap: wrap;
        }

        .control-btn {
            background: linear-gradient(135deg, #1db954 0%, #1ed760 100%);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 16px;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 56px;
            min-height: 56px;
            margin: 4px;
            box-shadow: 
                0 4px 15px rgba(29, 185, 84, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .control-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .control-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .control-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 
                0 8px 25px rgba(29, 185, 84, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }
        
        .control-btn:active {
            transform: translateY(-1px) scale(0.98);
            box-shadow: 
                0 3px 10px rgba(29, 185, 84, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .shuffle-btn.active {
            background: #0b6838 !important;
            box-shadow: 0 0 10px #0b6838;
        }

        .playlist-name {
            margin: 10px 0;
            font-size: 1.4em;
            background: linear-gradient(135deg, #1db954 0%, #1ed760 50%, #00ff88 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            padding: 8px 16px;
            display: block !important;
            visibility: visible !important;
            width: 100%;
            text-shadow: 0 0 30px rgba(29, 185, 84, 0.5);
            letter-spacing: 0.5px;
            animation: shimmer 3s ease-in-out infinite;
        }
        
        @keyframes shimmer {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .back-btn {
            background: linear-gradient(135deg, #ff3333 0%, #ff5555 100%);
            padding: 12px 24px;
            border-radius: 16px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 15px;
            font-weight: 600;
            box-shadow: 
                0 4px 15px rgba(255, 51, 51, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: 0.5px;
        }

        .back-btn:hover {
            background: linear-gradient(135deg, #ff5555 0%, #ff7777 100%);
            transform: translateY(-2px);
            box-shadow: 
                0 6px 20px rgba(255, 51, 51, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }
        
        .back-btn:active {
            transform: translateY(0);
            box-shadow: 
                0 2px 8px rgba(255, 51, 51, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        /* ××¤×§×˜ ×”×‘×”×•×‘ ×œ×›×¤×ª×•×¨ ×©× ×œ×—×¥ */
        @keyframes flashEffect {
            0% { background-color: #1db954; }
            50% { background-color: #004080; }
            100% { background-color: #1db954; }
        }

        .active-effect {
            animation: flashEffect 0.3s ease-in-out;
        }
        
        /* ×‘×¢×™×™×ª ×ª×¦×•×’×” - ×ª×™×§×•×Ÿ ××œ×× ×˜×™× ×©×œ× ××•×¦×’×™× */
        .control-buttons, .playlist-name, .current-song-container, .volume-control {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            width: 100% !important;
            margin: 10px 0 !important;
        }
        
        /* ×¡×’× ×•×Ÿ ×ª×¦×•×’×ª ×©×™×¨ × ×•×›×—×™ */
        .current-song-container {
            background: linear-gradient(135deg, rgba(29, 185, 84, 0.1) 0%, rgba(30, 215, 96, 0.05) 100%);
            backdrop-filter: blur(10px);
            padding: 16px 20px;
            border-radius: 16px;
            margin: 10px 0;
            border: 1px solid rgba(29, 185, 84, 0.3);
            border-right: 3px solid #1db954;
            width: 100%;
            text-align: right;
            display: block !important;
            visibility: visible !important;
            box-shadow: 
                0 4px 15px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }
        
        .current-song-container:hover {
            transform: translateX(-3px);
            border-right-width: 4px;
            box-shadow: 
                0 6px 20px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(29, 185, 84, 0.2);
        }
        
        .day-mode .current-song-container {
            background: rgba(0, 0, 0, 0.1);
            border-left: 3px solid #4169E1;
        }
        
        .current-song-label {
            font-size: 0.8em;
            opacity: 0.8;
        }
        
        .current-song {
            font-weight: 600;
            font-size: 1.1em;
            background: linear-gradient(90deg, #1db954 0%, #1ed760 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
            animation: slideText 20s linear infinite;
        }
        
        @keyframes slideText {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        
        /* ×¡×’× ×•×Ÿ ×‘×§×¨ ×¢×•×¦××ª ×©××¢ */
        .volume-control {
            width: 100%;
            display: flex !important;
            align-items: center;
            gap: 5px;
            margin: 5px 0;
            justify-content: center;
            visibility: visible !important;
        }
        
        .volume-slider {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, rgba(255,255,255,0.1) 0%, rgba(29,185,84,0.2) 100%);
            border-radius: 10px;
            outline: none;
            box-shadow: 
                inset 0 2px 4px rgba(0, 0, 0, 0.3),
                0 1px 0 rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }
        
        .volume-slider:hover {
            background: linear-gradient(90deg, rgba(255,255,255,0.15) 0%, rgba(29,185,84,0.3) 100%);
        }
        
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1db954 0%, #1ed760 100%);
            cursor: pointer;
            box-shadow: 
                0 4px 12px rgba(29, 185, 84, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .volume-slider::-webkit-slider-thumb:hover {
            transform: scale(1.15);
            box-shadow: 
                0 6px 16px rgba(29, 185, 84, 0.7),
                inset 0 1px 0 rgba(255, 255, 255, 0.4);
        }
        
        .volume-slider::-webkit-slider-thumb:active {
            transform: scale(1.05);
        }
        
        .volume-slider::-moz-range-thumb {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1db954 0%, #1ed760 100%);
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 4px 12px rgba(29, 185, 84, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }
        
        .day-mode .volume-slider::-webkit-slider-thumb {
            background: #4169E1;
        }
        
        .day-mode .volume-slider::-moz-range-thumb {
            background: #4169E1;
        }
        
        .volume-icon {
            font-size: 24px;
            cursor: pointer;
        }
        
        /* ×¡×’× ×•×Ÿ ×§×™×©×•×¨ ×”×ª×§× ×” ×œ××¡×š ×”×‘×™×ª */
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(29, 185, 84, 0.9);
            color: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 1000;
            animation: fadeIn 0.5s;
            direction: rtl;
            text-align: center;
        }
        
        .day-mode .install-prompt {
            background: rgba(65, 105, 225, 0.9);
        }
        
        .install-prompt button {
            background: white;
            color: #1db954;
            border: none;
            padding: 10px 15px;
            border-radius: 10px;
            margin-top: 10px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .day-mode .install-prompt button {
            color: #4169E1;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .day-mode .current-song {
            color: #4169E1;
        }

        /* ×¡×’× ×•×Ÿ ××ª×’ ×™×•×/×œ×™×œ×” */
        .mode-switch {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            cursor: pointer;
            z-index: 100;
        }

        .mode-icon {
            font-size: 24px;
        }

        /* ×¡×’× ×•×Ÿ ×œ××¦×‘ ×™×•× */
        .day-mode {
            background: linear-gradient(135deg, #89CFF0, #6495ED, #4169E1) !important;
        }

        .day-mode .music-player {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            box-shadow: 0 0 20px #4169E1;
        }

        .day-mode .control-btn {
            background: #4169E1;
        }

        .day-mode .control-btn:hover {
            background: #1E90FF;
        }

        .day-mode .playlist-name {
            color: #4169E1;
        }

        .day-mode .back-btn {
            background: #FF6347;
        }

        .day-mode .back-btn:hover {
            background: #FF4500;
        }

        /* ×”×ª×××” ×œ××¡×›×™× ×§×˜× ×™× */
        /* ×”×ª×××” ×œ××¡×›×™× ×©×•× ×™× */
        @media (max-height: 700px) {
            .music-player {
                transform: scale(0.9);
                margin-top: -20px;
            }
            .video-frame {
                height: 25vh;
            }
        }
        @media (max-width: 768px) {
            .control-btn {
                padding: 12px 20px;
                font-size: 20px;
                min-width: 60px;
                min-height: 60px;
            }
            
            .mode-switch {
                top: 10px;
                right: 10px;
            }
        }
        
        /* ×”×ª×××” ×œ××—×©×‘ ×©×•×œ×—× ×™ */
        @media (min-width: 1024px) {
            .music-player {
                max-width: 900px;
            }
            
            .control-buttons {
                margin: 10px auto;
            }
            
            /* ××¤×§×˜×™× ×œ××¢×‘×¨ ×¢×›×‘×¨ ×¢×œ ×›×¤×ª×•×¨×™× */
            .control-btn:hover {
                transform: translateY(-3px);
                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            }
        }

        /* ×›×¤×ª×•×¨ ×¡×’×™×¨×” ×œ×—×œ×•×Ÿ ×”×ª×§× ×” */
        .close-prompt {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 20px;
            width: 35px;
            background: linear-gradient(135deg, #1db954 0%, #1ed760 100%);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 
                0 4px 12px rgba(29, 185, 84, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .close-prompt:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .close-prompt:active {
            transform: scale(0.95);
        }

    </style>
</head>
<body>
    <!-- ××ª×’ ×™×•×/×œ×™×œ×” -->
    <div class="mode-switch" onclick="toggleDayNightMode()">
        <span class="mode-icon" id="mode-icon">ğŸŒ™</span>
    </div>

    <div class="music-player" id="musicPlayer">
        <h2 style="font-size: 22px; margin: 5px 0;">ğŸ¶ × ×’×Ÿ ××•×–×™×§×” ×œ×¨×›×‘ ğŸš—</h2>
        <div id="player" class="video-frame"></div>

        <div class="control-buttons">
            <button class="control-btn" onclick="buttonClickEffect(this); previousTrack()">â®</button>
            <button class="control-btn" onclick="buttonClickEffect(this); playVideo()">â–¶</button>
            <button class="control-btn" onclick="buttonClickEffect(this); pauseVideo()">â¸</button>
            <button class="control-btn" onclick="buttonClickEffect(this); nextTrack()">â­</button>
        </div>

        <div class="playlist-name" id="playlistName">ğŸµ ×¤×œ×™×™×œ×™×¡×˜ ×¨××©×™ - × ×”×™×’×” ×‘×›×™×£ ğŸš—</div>
        
        <!-- ×›×¤×ª×•×¨×™ × ×™×”×•×œ ×¤×œ×™×™×œ×™×¡×˜×™× -->
        <div class="control-buttons" style="margin-top: 10px;">
            <button class="control-btn" onclick="buttonClickEffect(this); previousPlaylist()" id="prevPlaylistBtn" style="display: none;">â®ï¸ ×¤×œ×™×™×œ×™×¡×˜ ×§×•×“×</button>
            <button class="control-btn" onclick="buttonClickEffect(this); openPlaylistManager()">âš™ï¸ × ×™×”×•×œ ×¤×œ×™×™×œ×™×¡×˜×™×</button>
            <button class="control-btn" onclick="buttonClickEffect(this); nextPlaylist()" id="nextPlaylistBtn" style="display: none;">×¤×œ×™×™×œ×™×¡×˜ ×”×‘× â­ï¸</button>
        </div>
        
        <!-- ×ª×¦×•×’×ª ×©×™×¨ × ×•×›×—×™ -->
        <div class="current-song-container" id="currentSongContainer">
            <div class="current-song-label">×©×™×¨ × ×•×›×—×™:</div>
            <div class="current-song" id="currentSong">×˜×•×¢×Ÿ...</div>
        </div>
        
        <!-- ×‘×§×¨ ×¢×•×¦××ª ×©××¢ -->
        <div class="volume-control" id="volumeControl">
            <span class="volume-icon" onclick="toggleMute()" id="volumeIcon">ğŸ”Š</span>
            <input type="range" min="0" max="100" value="100" class="volume-slider" id="volumeSlider">
        </div>

        <button class="back-btn" onclick="buttonClickEffect(this); goBack()">ğŸ”™ ×—×–×¨×” ×œ×ª×¤×¨×™×˜ ×”×¨××©×™</button>
        
        <!-- ×”×•×¡×¨×• ×§×™×¦×•×¨×™ ××§×œ×“×ª ×›×“×™ ×œ×—×¡×•×š ××§×•× ×‘××¡×š -->
    </div>

    <!-- ××•×“××œ × ×™×”×•×œ ×¤×œ×™×™×œ×™×¡×˜×™× -->
    <div id="playlistModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; overflow-y: auto;">
        <div style="max-width: 500px; margin: 20px auto; background: #333; padding: 20px; border-radius: 15px; border: 2px solid #1db954;">
            <h2 style="color: #1db954; text-align: center;">âš™ï¸ × ×™×”×•×œ ×¤×œ×™×™×œ×™×¡×˜×™×</h2>
            
            <!-- ×˜×•×¤×¡ ×”×•×¡×¤×ª ×¤×œ×™×™×œ×™×¡×˜ -->
            <div style="background: #222; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="color: white; margin-top: 0;">â• ×”×•×¡×£ ×¤×œ×™×™×œ×™×¡×˜ ×—×“×©</h3>
                <input type="text" id="newPlaylistName" placeholder="×©× ×”×¤×œ×™×™×œ×™×¡×˜ (×œ×“×•×’××”: ××•×–×™×§×” ×œ× ×¡×™×¢×”)" 
                    style="width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 5px; border: 1px solid #1db954; background: #444; color: white; font-size: 16px; box-sizing: border-box;">
                <input type="text" id="newPlaylistId" placeholder="YouTube Playlist ID (×œ×“×•×’××”: PLWkfrFkdyL1Fdaso2jWg1gevOxRe2jKvG)" 
                    style="width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 5px; border: 1px solid #1db954; background: #444; color: white; font-size: 16px; box-sizing: border-box;">
                <button onclick="addNewPlaylist()" style="width: 100%; padding: 12px; background: #1db954; color: white; border: none; border-radius: 5px; font-size: 18px; cursor: pointer; font-weight: bold;">
                    â• ×”×•×¡×£ ×¤×œ×™×™×œ×™×¡×˜
                </button>
                <div style="margin-top: 10px; font-size: 12px; color: #aaa; text-align: right;">
                    ğŸ’¡ ××™×š ×œ××¦×•× Playlist ID: ×¤×ª×— ×¤×œ×™×™×œ×™×¡×˜ ×‘-YouTube, ×”×¢×ª×§ ××ª ×”×§×•×“ ××—×¨×™ "list=" ×‘×›×ª×•×‘×ª
                </div>
            </div>
            
            <!-- ×¨×©×™××ª ×¤×œ×™×™×œ×™×¡×˜×™× ×§×™×™××™× -->
            <div style="background: #222; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="color: white; margin-top: 0;">ğŸ“‹ ×¤×œ×™×™×œ×™×¡×˜×™× ×§×™×™××™×</h3>
                <div id="playlistList"></div>
            </div>
            
            <button onclick="closePlaylistManager()" style="width: 100%; padding: 12px; background: #666; color: white; border: none; border-radius: 5px; font-size: 18px; cursor: pointer; font-weight: bold;">
                âœ–ï¸ ×¡×’×•×¨
            </button>
        </div>
    </div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        let player;
        let currentPlaylistIndex = 0;
        let isShuffle = false;
        let isDayMode = false; // ××¦×‘ ×‘×¨×™×¨×ª ××—×“×œ: ××¦×‘ ×œ×™×œ×”
        let lastVolume = 100; // × ×•×¡×™×£ ××©×ª× ×” ×œ×©××™×¨×ª ×¢×•×¦××ª ×”×§×•×œ ×”××—×¨×•× ×”
        let deferredPrompt; // ×œ×©××™×¨×ª ×”××™×¨×•×¢ ×©×œ ×”×ª×§× ×ª PWA
        let hasUserInteracted = false; // ×× ×™×¢×ª autoplay â€“ × × ×’×Ÿ ×¨×§ ×œ××—×¨ ×œ×—×™×¦×”
        let adDetectionInterval = null; // ××–×”×” ×–×™×”×•×™ ×¤×¨×¡×•××•×ª
        let isAdPlaying = false; // ×”×× ××ª× ×’× ×ª ×¤×¨×¡×•××ª ×›×¨×’×¢
        let lastKnownDuration = 0; // ××©×š ×”×¡×¨×˜×•×Ÿ ×”××—×¨×•×Ÿ ×©× ×©××¨
        let lastVideoUrl = ''; // URL ×”×¡×¨×˜×•×Ÿ ×”××—×¨×•×Ÿ
        let consecutiveAdChecks = 0; // ××¡×¤×¨ ×‘×“×™×§×•×ª ×¨×¦×™×¤×•×ª ×©×–×™×”×• ×¤×¨×¡×•××ª

        // ×˜×¢×™× ×ª ×¤×œ×™×™×œ×™×¡×˜×™× ×-LocalStorage ××• ×‘×¨×™×¨×ª ××—×“×œ
        let playlists = JSON.parse(localStorage.getItem('musicPlaylists')) || [
            { name: "ğŸµ ×¤×œ×™×™×œ×™×¡×˜ ×¨××©×™ - × ×”×™×’×” ×‘×›×™×£ ğŸš—", id: "PLWkfrFkdyL1Fdaso2jWg1gevOxRe2jKvG" },
            { name: "ğŸ¸ ×¨×•×§ ×™×©×¨××œ×™ ğŸ‡®ğŸ‡±", id: "PLWkfrFkdyL1Fdaso2jWg1gevOxRe2jKvG" },
            { name: "ğŸ¤ ××–×¨×—×™×ª ××•×©×œ××ª ğŸ’ƒ", id: "PLWkfrFkdyL1Fdaso2jWg1gevOxRe2jKvG" }
        ];
        
        // ×©××™×¨×ª ×¤×œ×™×™×œ×™×¡×˜×™× ×‘-LocalStorage
        function savePlaylists() {
            localStorage.setItem('musicPlaylists', JSON.stringify(playlists));
            updatePlaylistNavigation();
        }

        // ×¢×“×›×•×Ÿ ×ª×¦×•×’×ª ×›×¤×ª×•×¨×™ × ×™×•×•×˜ ×¤×œ×™×™×œ×™×¡×˜×™×
        function updatePlaylistNavigation() {
            const prevBtn = document.getElementById('prevPlaylistBtn');
            const nextBtn = document.getElementById('nextPlaylistBtn');
            
            if (playlists.length > 1) {
                prevBtn.style.display = 'inline-block';
                nextBtn.style.display = 'inline-block';
            } else {
                prevBtn.style.display = 'none';
                nextBtn.style.display = 'none';
            }
        }

        // ×¤×ª×™×—×ª ××•×“××œ × ×™×”×•×œ ×¤×œ×™×™×œ×™×¡×˜×™×
        function openPlaylistManager() {
            document.getElementById('playlistModal').style.display = 'block';
            renderPlaylistList();
        }

        // ×¡×’×™×¨×ª ××•×“××œ × ×™×”×•×œ ×¤×œ×™×™×œ×™×¡×˜×™×
        function closePlaylistManager() {
            document.getElementById('playlistModal').style.display = 'none';
        }

        // ×”×¦×’×ª ×¨×©×™××ª ×¤×œ×™×™×œ×™×¡×˜×™× ×‘××•×“××œ
        function renderPlaylistList() {
            const listContainer = document.getElementById('playlistList');
            
            if (playlists.length === 0) {
                listContainer.innerHTML = '<p style="color: #aaa; text-align: center;">××™×Ÿ ×¤×œ×™×™×œ×™×¡×˜×™×. ×”×•×¡×£ ×¤×œ×™×™×œ×™×¡×˜ ×—×“×© ×œ××¢×œ×”.</p>';
                return;
            }
            
            listContainer.innerHTML = playlists.map((playlist, index) => `
                <div style="background: #444; padding: 12px; margin-bottom: 10px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                    <div style="flex: 1; text-align: right;">
                        <div style="color: white; font-weight: bold; margin-bottom: 5px;">${playlist.name}</div>
                        <div style="color: #aaa; font-size: 12px;">ID: ${playlist.id}</div>
                    </div>
                    <button onclick="deletePlaylist(${index})" style="background: #e74c3c; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; margin-right: 10px;">
                        ğŸ—‘ï¸ ××—×§
                    </button>
                </div>
            `).join('');
        }

        // ×”×•×¡×¤×ª ×¤×œ×™×™×œ×™×¡×˜ ×—×“×©
        function addNewPlaylist() {
            const nameInput = document.getElementById('newPlaylistName');
            const idInput = document.getElementById('newPlaylistId');
            
            const name = nameInput.value.trim();
            const id = idInput.value.trim();
            
            if (!name || !id) {
                alert('âŒ ×× × ××œ× ××ª ×©× ×”×¤×œ×™×™×œ×™×¡×˜ ×•×”-ID');
                return;
            }
            
            // ×‘×“×™×§×” ×× ×”-ID ×›×‘×¨ ×§×™×™×
            if (playlists.some(p => p.id === id)) {
                alert('âŒ ×¤×œ×™×™×œ×™×¡×˜ ×¢× ID ×–×” ×›×‘×¨ ×§×™×™×');
                return;
            }
            
            playlists.push({ name, id });
            savePlaylists();
            renderPlaylistList();
            
            // × ×™×§×•×™ ×”×©×“×•×ª
            nameInput.value = '';
            idInput.value = '';
            
            alert('âœ… ×”×¤×œ×™×™×œ×™×¡×˜ × ×•×¡×£ ×‘×”×¦×œ×—×”!');
        }

        // ××—×™×§×ª ×¤×œ×™×™×œ×™×¡×˜
        function deletePlaylist(index) {
            if (playlists.length === 1) {
                alert('âŒ ×œ× × ×™×ª×Ÿ ×œ××—×•×§ ××ª ×”×¤×œ×™×™×œ×™×¡×˜ ×”××—×¨×•×Ÿ');
                return;
            }
            
            const playlist = playlists[index];
            if (confirm(`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª "${playlist.name}"?`)) {
                playlists.splice(index, 1);
                
                // ×× ××—×§× ×• ××ª ×”×¤×œ×™×™×œ×™×¡×˜ ×”× ×•×›×—×™, ×¢×‘×•×¨ ×œ×¨××©×•×Ÿ
                if (currentPlaylistIndex >= playlists.length) {
                    currentPlaylistIndex = 0;
                    reloadPlayer();
                } else if (currentPlaylistIndex === index) {
                    reloadPlayer();
                }
                
                savePlaylists();
                renderPlaylistList();
                updatePlaylistName();
                
                alert('âœ… ×”×¤×œ×™×™×œ×™×¡×˜ × ××—×§ ×‘×”×¦×œ×—×”!');
            }
        }

        function onYouTubeIframeAPIReady() {
            console.log('YouTube API × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”');
            
            // ×”×¦×’×ª ×”×•×“×¢×” ×œ××©×ª××© ×©×”×¤×œ×™×™×œ×™×¡×˜ × ×˜×¢×Ÿ
            document.getElementById('currentSong').textContent = '×˜×•×¢×Ÿ ×¤×œ×™×™×œ×™×¡×˜... ×× × ×”××ª×Ÿ';
            
            try {
                createPlayer();
            } catch (e) {
                console.error('×©×’×™××” ×‘×˜×¢×™× ×ª × ×’×Ÿ YouTube:', e);
                // × ×™×¡×™×•×Ÿ ×©× ×™ ×¢× ×”×©×”×™×™×”
                setTimeout(() => {
                    try {
                        createPlayer();
                    } catch (error) {
                        console.error('× ×™×¡×™×•×Ÿ ×©× ×™ × ×›×©×œ:', error);
                        // ×™×¦×™×¨×ª iframe ×™×©×™×¨×•×ª ×œ×œ× autoplay
                        document.getElementById('player').innerHTML = '<iframe width="100%" height="350" src="https://www.youtube.com/embed/videoseries?list=' + 
                            playlists[currentPlaylistIndex].id + 
                            '&autoplay=0&rel=0&modestbranding=1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>';
                    }
                }, 1500);
            }
        }

        function createPlayer() {
            console.log('×™×•×¦×¨ × ×’×Ÿ YouTube...');
            try {
                player = new YT.Player('player', {
                    height: '350',
                    width: '100%',
                    playerVars: {
                        'autoplay': 0,
                        'controls': 1,
                        'listType': 'playlist',
                        'list': playlists[currentPlaylistIndex].id,
                        'rel': 0,
                        'modestbranding': 1,
                        'enablejsapi': 1
                    },
                events: {
                    'onReady': () => {
                        updatePlaylistName();
                        // ×”×•×“×¢×” ×œ××©×ª××© ×©×¦×¨×™×š ×œ×œ×—×•×¥ ×¢×œ ×›×¤×ª×•×¨ ×”× ×™×’×•×Ÿ
                        document.getElementById('currentSong').textContent = '××•×›×Ÿ ×œ× ×’×Ÿ â€“ ×œ×—×¥ ×¢×œ â–¶ï¸ ×›×“×™ ×œ×”×ª×—×™×œ';
                        // ×•×™×“×•× ×©×”× ×’×Ÿ ×‘××¦×‘ ×¢×¦×™×¨×” ×¢×“ ×œ×¤×¢×•×œ×” ×©×œ ×”××©×ª××©
                        if (player && player.pauseVideo) {
                            player.pauseVideo();
                        }
                        // ×× ×”××©×ª××© ×‘×—×¨ ×¢×¨×‘×•×‘ ××¨××©, × ×©××•×¨ ××ª ×”×”×¢×“×¤×” ×•× × ×’×Ÿ ×¨×§ ××—×¨×™ ×œ×—×™×¦×”
                        if (isShuffle && player && player.setShuffle) {
                            player.setShuffle(true);
                        }
                    },
                    'onStateChange': (event) => {
                        // ×¢×“×›×•×Ÿ ×©× ×”×©×™×¨ ×›××©×¨ ×”×©×™×¨ ××©×ª× ×”
                        if (event.data === YT.PlayerState.PLAYING) {
                            updateCurrentSong();
                        }
                    },
                    'onError': handlePlayerError
                }
            });
            } catch (error) {
                console.error('×©×’×™××” ×‘×™×¦×™×¨×ª × ×’×Ÿ YouTube:', error);
                // × ×™×¡×™×•×Ÿ ×©× ×™ ×× ×”×¨××©×•×Ÿ × ×›×©×œ
                setTimeout(() => {
                    try {
                        document.getElementById('player').innerHTML = '<iframe width="100%" height="350" src="https://www.youtube.com/embed/videoseries?list=' + 
                            playlists[currentPlaylistIndex].id + 
                            '&autoplay=0&rel=0&modestbranding=1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>';
                    } catch (e) {
                        console.error('× ×™×¡×™×•×Ÿ ×™×¦×™×¨×ª × ×’×Ÿ ×’×™×‘×•×™ × ×›×©×œ:', e);
                    }
                }, 1000);
            }
        }

        function updatePlaylistName() {
            document.getElementById('playlistName').textContent = playlists[currentPlaylistIndex].name;
        }

        function playVideo() {
            if (player && player.playVideo) {
                hasUserInteracted = true;
                player.playVideo();
                startAdDetection(); // ×”×¤×¢×œ ×–×™×”×•×™ ×¤×¨×¡×•××•×ª
            }
        }

        function pauseVideo() {
            if (player && player.pauseVideo) {
                player.pauseVideo();
                stopAdDetection(); // ×¢×¦×•×¨ ×–×™×”×•×™ ×¤×¨×¡×•××•×ª
            }
        }

        function nextTrack() {
            if (player && player.nextVideo) {
                hasUserInteracted = true;
                player.nextVideo();
            }
        }

        function previousTrack() {
            if (player && player.previousVideo) {
                hasUserInteracted = true;
                player.previousVideo();
            }
        }

        function nextPlaylist() {
            currentPlaylistIndex = (currentPlaylistIndex + 1) % playlists.length;
            console.log(`××¢×‘×¨ ×œ×¤×œ×™×™×œ×™×¡×˜ ×”×‘×: ${playlists[currentPlaylistIndex].name}`);
            hasUserInteracted = true;
            reloadPlayer();
            
            // ×”×•×¡×¤×ª ××¤×§×˜ ×•×™×–×•××œ×™ ×›×“×™ ×©×”××©×ª××© ×™×“×¢ ×©×”×¤×¢×•×œ×” ×”×ª×§×‘×œ×”
            const playlistName = document.getElementById('playlistName');
            playlistName.style.animation = 'none';
            setTimeout(() => {
                playlistName.style.animation = 'flashEffect 0.5s';
            }, 10);
        }

        function previousPlaylist() {
            currentPlaylistIndex = (currentPlaylistIndex - 1 + playlists.length) % playlists.length;
            console.log(`××¢×‘×¨ ×œ×¤×œ×™×™×œ×™×¡×˜ ×”×§×•×“×: ${playlists[currentPlaylistIndex].name}`);
            hasUserInteracted = true;
            reloadPlayer();
            
            // ×”×•×¡×¤×ª ××¤×§×˜ ×•×™×–×•××œ×™ ×›×“×™ ×©×”××©×ª××© ×™×“×¢ ×©×”×¤×¢×•×œ×” ×”×ª×§×‘×œ×”
            const playlistName = document.getElementById('playlistName');
            playlistName.style.animation = 'none';
            setTimeout(() => {
                playlistName.style.animation = 'flashEffect 0.5s';
            }, 10);
        }

        function reloadPlayer() {
            console.log(`×˜×•×¢×Ÿ ××—×“×© ×¤×œ×™×™×œ×™×¡×˜: ${playlists[currentPlaylistIndex].name}`);

            try {
                if (player) {
                    player.destroy();
                }
                
                // ×™×¦×™×¨×ª × ×’×Ÿ ×—×“×© ×œ××—×¨ ×”×©×”×™×™×” ×§×¦×¨×”
                setTimeout(() => {
                    createPlayer();
                    
                    // ×× ×”×™×¦×™×¨×” × ×›×©×œ×”, × ×¡×” ×‘×“×¨×š ××—×¨×ª
                    setTimeout(() => {
                        if (!player || (player && typeof player.getPlayerState !== 'function')) {
                            console.log('× ×™×¡×™×•×Ÿ ×œ×˜×¢×•×Ÿ ××ª ×”×¤×œ×™×™×œ×™×¡×˜ ×‘×“×¨×š ×™×©×™×¨×”');
                            document.getElementById('player').innerHTML = '<iframe width="100%" height="350" src="https://www.youtube.com/embed/videoseries?list=' + 
                                playlists[currentPlaylistIndex].id + 
                                '&autoplay=0&rel=0&modestbranding=1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>';

                            // ×¢×“×›×•×Ÿ ×©× ×”×¤×œ×™×™×œ×™×¡×˜ ×’× ×‘××¦×‘ ×–×”
                            updatePlaylistName();
                        }
                    }, 2000);
                }, 500);
            } catch (error) {
                console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×¤×œ×™×™×œ×™×¡×˜:', error);

                // × ×™×¡×™×•×Ÿ ××—×¨×•×Ÿ ×‘×××¦×¢×•×ª ×”×˜××¢×” ×™×©×™×¨×” ×œ×œ× autoplay
                document.getElementById('player').innerHTML = '<iframe width="100%" height="350" src="https://www.youtube.com/embed/videoseries?list=' + 
                    playlists[currentPlaylistIndex].id + 
                    '&autoplay=0&rel=0&modestbranding=1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>';

                updatePlaylistName();
            }
        }

        function toggleShuffle() {
            if (!player || !player.getPlaylist) {
                return;
            }

            isShuffle = !isShuffle;

            try {
                if (player.setShuffle) {
                    player.setShuffle(isShuffle);
                }
            } catch (err) {
                console.warn('×œ× × ×™×ª×Ÿ ×œ×¢×“×›×Ÿ ××¦×‘ Shuffle:', err);
            }

            if (isShuffle) {
                shufflePlaylist();
            }
        }

        function shufflePlaylist() {
            if (player && player.getPlaylist) {
                hasUserInteracted = true;
                let playlist = player.getPlaylist();
                if (playlist && playlist.length > 0) {
                    let randomIndex = Math.floor(Math.random() * playlist.length);
                    player.playVideoAt(randomIndex);
                }
            }
        }

        function goBack() {
            // ××›×™×•×•×Ÿ ×©××“×•×‘×¨ ×‘×™×™×©×•× ×“×£ ×‘×•×“×“, × ×¢×‘×™×¨ ×œ×“×£ ×”×“××” ×©×œ ×ª×¤×¨×™×˜ ×¨××©×™
            alert('×ª×•×“×” ×©×”×©×ª××©×ª ×‘× ×’×Ÿ ×”××•×–×™×§×” ×œ×¨×›×‘!\n×–×” ×”×“×£ ×”×¨××©×™ ×©×œ ×”××¤×œ×™×§×¦×™×”.');
        }

        function buttonClickEffect(button) {
            button.classList.add("active-effect");
            setTimeout(() => {
                button.classList.remove("active-effect");
            }, 300);
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }
        }
        // ×¤×•× ×§×¦×™×” ×œ×”×—×œ×¤×ª ××¦×‘ ×™×•×/×œ×™×œ×”
        function toggleDayNightMode() {
            isDayMode = !isDayMode;
            const body = document.body;
            const modeIcon = document.getElementById('mode-icon');
            
            if (isDayMode) {
                body.classList.add('day-mode');
                modeIcon.textContent = '\u2600\uFE0F'; // ×¡××œ ×©××©
            } else {
                body.classList.remove('day-mode');
                modeIcon.textContent = '\ud83c\udf19'; // ×¡××œ ×™×¨×—
            }
            
            // ×”×¤×¢×œ×ª ××¤×§×˜ ×œ×—×™×¦×” ×¢×œ ×”××ª×’
            buttonClickEffect(document.querySelector('.mode-switch'));
        }
        
        // ×‘×“×™×§×ª ×–××Ÿ ×™×•× ××•×˜×•××˜×™×ª ×‘×˜×¢×™× ×”
        function checkDayTime() {
            const hour = new Date().getHours();
            // ×× ×”×©×¢×” ×‘×™×Ÿ 7 ×‘×‘×•×§×¨ ×œ-19 ×‘×¢×¨×‘, ×”×¤×¢×œ ××¦×‘ ×™×•×
            if (hour >= 7 && hour < 19 && !isDayMode) {
                toggleDayNightMode();
            }
        }
        
        // ×‘×“×™×§×ª ×–××Ÿ ×™×•× ×‘×˜×¢×™× ×”
        window.addEventListener('load', checkDayTime);
        
        // ×× ×™×¢×ª ×›×™×‘×•×™ ××¡×š
        function preventScreenSleep() {
            // ×©×™××•×© ×‘-NoSleep.js ×œ×× ×™×¢×ª ×›×™×‘×•×™ ××¡×š
            if ('wakeLock' in navigator) {
                // ×× ×”×“×¤×“×¤×Ÿ ×ª×•××š ×‘-Wake Lock API
                let wakeLock = null;
                
                const requestWakeLock = async () => {
                    try {
                        wakeLock = await navigator.wakeLock.request('screen');
                        console.log('××¡×š × ×©××¨ ×“×œ×•×§ - Wake Lock ×”×•×¤×¢×œ');
                        
                        wakeLock.addEventListener('release', () => {
                            console.log('Wake Lock ×©×•×—×¨×¨, ×× ×¡×” ×œ×”×¤×¢×™×œ ××—×“×©...');
                            requestWakeLock(); // × ×™×¡×™×•×Ÿ ×œ×”×¤×¢×™×œ ××—×“×©
                        });
                    } catch (err) {
                        console.error(`×œ× × ×™×ª×Ÿ ×œ×”×¤×¢×™×œ Wake Lock: ${err.name}, ${err.message}`);
                        // ×”×¤×¢×œ×ª ×©×™×˜×” ×—×œ×•×¤×™×ª - × ×’×™× ×ª ×¡×¨×˜×•×Ÿ ×©×§×˜ ×œ×œ× × ×¨××•×ª
                        fallbackNoSleep();
                    }
                };
                
                // ×”×¤×¢×œ×ª Wake Lock ×‘×¢×ª ×˜×¢×™× ×ª ×”×“×£
                requestWakeLock();
                
                // ×”×¤×¢×œ×” ××—×“×© ×©×œ Wake Lock ×›××©×¨ ×”×“×£ ×—×•×–×¨ ×œ×”×™×•×ª ×’×œ×•×™
                document.addEventListener('visibilitychange', () => {
                    if (document.visibilityState === 'visible' && wakeLock === null) {
                        requestWakeLock();
                    }
                });
            } else {
                // ×©×™×˜×” ×—×œ×•×¤×™×ª ×× ×”×“×¤×“×¤×Ÿ ×œ× ×ª×•××š ×‘-Wake Lock API
                fallbackNoSleep();
            }
        }
        
        // ×©×™×˜×” ×—×œ×•×¤×™×ª ×œ×× ×™×¢×ª ×›×™×‘×•×™ ××¡×š
        function fallbackNoSleep() {
            // ×™×¦×™×¨×ª ××œ×× ×˜ ××•×“×™×• ×©×™× ×•×’×Ÿ ×‘×¨×§×¢ ×‘×©×§×˜
            console.log('××¤×¢×™×œ ×©×™×˜×” ×—×œ×•×¤×™×ª ×œ×× ×™×¢×ª ×›×™×‘×•×™ ××¡×š');
            setInterval(() => {
                // ×™×¦×™×¨×ª ×ª×–×•×–×” ×§×˜× ×” ×›×œ 30 ×©× ×™×•×ª ×›×“×™ ×œ×× ×•×¢ ×›×™×‘×•×™ ××¡×š
                window.scrollBy(0, 1);
                window.scrollBy(0, -1);
            }, 30000);
        }
        
        // ×–×™×”×•×™ ×•×“×™×œ×•×’ ×¢×œ ×¤×¨×¡×•××•×ª - ××œ×’×•×¨×™×ª× ××©×•×¤×¨ ×‘××™×•×—×“ ×œ-PWA
        function detectAndSkipAds() {
            if (!player || !player.getDuration || !player.getCurrentTime) return;
            
            try {
                const duration = player.getDuration();
                const currentTime = player.getCurrentTime();
                const playerState = player.getPlayerState();
                let currentUrl = '';
                let videoData = null;
                
                // × ×¡×” ×œ×§×‘×œ URL ×•-videoData (×¢×©×•×™ ×œ×”×™×›×©×œ ×‘×¤×¨×¡×•××•×ª)
                try {
                    currentUrl = player.getVideoUrl ? player.getVideoUrl() : '';
                    videoData = player.getVideoData ? player.getVideoData() : null;
                } catch (e) {
                    // ×× × ×›×©×œ ×œ×§×‘×œ ××™×“×¢ - ×–×” ×›× ×¨××” ×¤×¨×¡×•××ª!
                    console.log('âš ï¸ ×œ× × ×™×ª×Ÿ ×œ×§×‘×œ ××™×“×¢ ×¢×œ ×”×¡×¨×˜×•×Ÿ - ×›× ×¨××” ×¤×¨×¡×•××ª');
                }
                
                // ×‘×“×™×§×” ××™×•×—×“×ª ×œ-PWA: ×”×× ×–×” standalone mode?
                const isPWA = window.matchMedia('(display-mode: standalone)').matches || 
                              window.navigator.standalone === true;
                
                // ××¡×˜×¨×˜×’×™×•×ª ×–×™×”×•×™ ××©×•×œ×‘×•×ª:
                let adIndicators = 0;
                
                // 1. ×‘×“×™×§×ª ××©×š ×§×¦×¨ (×¤×¨×¡×•××•×ª ×‘×“×¨×š ×›×œ×œ 6-90 ×©× ×™×•×ª)
                if (duration > 0 && duration >= 3 && duration <= 120) {
                    adIndicators++;
                }
                
                // 2. ×©×™× ×•×™ ×¤×ª××•××™ ×‘-URL ××• ×‘××©×š
                if (lastVideoUrl && currentUrl && currentUrl !== lastVideoUrl) {
                    adIndicators++;
                }
                if (lastKnownDuration > 0 && Math.abs(duration - lastKnownDuration) > 15) {
                    adIndicators++;
                }
                
                // 3. ×‘×“×™×§×ª ×©× ×”×¡×¨×˜×•×Ÿ (×¤×¨×¡×•××•×ª ×œ×¢×™×ª×™× ×§×¨×•×‘×•×ª ×™×© ××™×œ×™× ××¡×•×™××•×ª)
                if (videoData && videoData.title) {
                    const title = videoData.title.toLowerCase();
                    const adKeywords = ['ad', 'advertisement', 'sponsor', '×¤×¨×¡×•××ª', '××•×¢×¦×¨', 'promo', 'commercial'];
                    if (adKeywords.some(keyword => title.includes(keyword))) {
                        adIndicators += 3; // ××©×§×œ ×’×‘×•×” ×××•×“
                    }
                    
                    // ×× ××™×Ÿ ×›×•×ª×¨×ª ××• ×›×•×ª×¨×ª ×¨×™×§×” - ×—×©×•×“
                    if (!title || title.trim() === '') {
                        adIndicators += 2;
                    }
                } else {
                    // ×× ××™×Ÿ videoData ×‘×›×œ×œ - ×—×©×•×“ ×××•×“
                    adIndicators += 2;
                }
                
                // 4. ×‘×“×™×§×ª ×”×ª× ×”×’×•×ª ××©×•× ×”
                const timeRemaining = duration - currentTime;
                if (timeRemaining > 0 && timeRemaining < 40 && duration < 90) {
                    adIndicators++;
                }
                
                // 5. ×‘×“×™×§×” ××™×•×—×“×ª ×œ-PWA - ×× ×‘-standalone mode, ×”×™×” ×™×•×ª×¨ ××’×¨×¡×™×‘×™
                if (isPWA && duration > 0 && duration < 60) {
                    adIndicators += 2;
                    console.log('ğŸ” PWA Mode - ×–×™×”×•×™ ××’×¨×¡×™×‘×™ ×™×•×ª×¨');
                }
                
                // ×”×—×œ×˜×”: ×× ×™×© 2+ ××™× ×“×™×§×˜×•×¨×™× (××• 3+ ×‘-PWA), ×–×• ×›× ×¨××” ×¤×¨×¡×•××ª
                const threshold = isPWA ? 3 : 2;
                const isPossibleAd = adIndicators >= threshold && playerState === 1;
                
                if (isPossibleAd) {
                    consecutiveAdChecks++;
                    
                    // ×‘-PWA mode - ×”×©×ª×§ ××™×“ ×œ×œ× ×”××ª× ×”
                    const checksNeeded = isPWA ? 1 : 2;
                    
                    if (!isAdPlaying && consecutiveAdChecks >= checksNeeded) {
                        console.log(`ğŸš« ×–×•×”×ª×” ×¤×¨×¡×•××ª! (××™× ×“×™×§×˜×•×¨×™×: ${adIndicators}, PWA: ${isPWA}) - ××©×ª×™×§ ×•××“×œ×’`);
                        isAdPlaying = true;
                        
                        // ×”×©×ª×§×ª ×©××¢ ××™×™×“×™×ª
                        if (player.isMuted && !player.isMuted()) {
                            lastVolume = player.getVolume();
                            player.mute();
                        }
                    }
                    
                    // ×“×™×œ×•×’ ××’×¨×¡×™×‘×™ ×‘××™×•×—×“ ×‘-PWA
                    if (isAdPlaying) {
                        if (currentTime < duration - 1) {
                            // ×§×¤×™×¦×” ×’×“×•×œ×” ×™×•×ª×¨ ×‘-PWA
                            const skipAmount = isPWA ? 15 : 10;
                            const skipTo = Math.min(duration - 0.3, currentTime + skipAmount);
                            player.seekTo(skipTo, true);
                        } else {
                            // ×›××¢×˜ ×‘×¡×•×£ - ×¢×‘×•×¨ ×œ×©×™×¨ ×”×‘×
                            console.log('â­ï¸ ××¢×‘×™×¨ ×œ×©×™×¨ ×”×‘×...');
                            if (player.nextVideo) {
                                player.nextVideo();
                            }
                        }
                    }
                } else {
                    // ×œ× ×¤×¨×¡×•××ª - ××™×¤×•×¡ ×•×”×—×–×¨×ª ×©××¢
                    consecutiveAdChecks = 0;
                    
                    if (isAdPlaying) {
                        console.log('âœ… ×¤×¨×¡×•××ª ×”×¡×ª×™×™××” - ××—×–×™×¨ ×©××¢ ×¨×’×™×œ');
                        isAdPlaying = false;
                        
                        if (player.isMuted && player.isMuted() && lastVolume > 0) {
                            player.unMute();
                            player.setVolume(lastVolume);
                        }
                    }
                    
                    // ×¢×“×›×•×Ÿ × ×ª×•× ×™× ××—×¨×•× ×™×
                    if (duration > 60) { // ×¨×§ ×©×™×¨×™× ×××™×ª×™×™×
                        lastKnownDuration = duration;
                    }
                }
                
                lastVideoUrl = currentUrl;
                
            } catch (e) {
                console.error('×©×’×™××” ×‘×–×™×”×•×™ ×¤×¨×¡×•××•×ª:', e);
            }
        }
        
        // ×”×¤×¢×œ×ª ×–×™×”×•×™ ×¤×¨×¡×•××•×ª
        function startAdDetection() {
            if (adDetectionInterval) {
                clearInterval(adDetectionInterval);
            }
            // ×‘×“×™×§×” ×›×œ 200 ××™×œ×™×©× ×™×•×ª ×‘-PWA, 300 ×‘×“×¤×“×¤×Ÿ ×¨×’×™×œ
            const isPWA = window.matchMedia('(display-mode: standalone)').matches || 
                          window.navigator.standalone === true;
            const checkInterval = isPWA ? 200 : 300;
            adDetectionInterval = setInterval(detectAndSkipAds, checkInterval);
            console.log(`ğŸ›¡ï¸ ××¢×¨×›×ª ×–×™×”×•×™ ×¤×¨×¡×•××•×ª ×”×•×¤×¢×œ×” (${isPWA ? 'PWA' : 'Browser'} mode, ${checkInterval}ms)`);
        }
        
        // ×¢×¦×™×¨×ª ×–×™×”×•×™ ×¤×¨×¡×•××•×ª
        function stopAdDetection() {
            if (adDetectionInterval) {
                clearInterval(adDetectionInterval);
                adDetectionInterval = null;
            }
        }

        // ×¢×“×›×•×Ÿ Media Session API ×œ× ×™×’×•×Ÿ ×‘×¨×§×¢
        function updateMediaSession(title) {
            if ('mediaSession' in navigator) {
                try {
                    navigator.mediaSession.metadata = new MediaMetadata({
                        title: title || '× ×’×Ÿ ××•×–×™×§×” ×œ×¨×›×‘',
                        artist: playlists[currentPlaylistIndex].name,
                        album: 'ğŸ¶ × ×’×Ÿ ×©×™×¨×™× ×œ×¨×›×‘ ğŸš—',
                        artwork: [
                            { src: 'car-music-icon.png', sizes: '192x192', type: 'image/png' },
                            { src: 'car-music-icon.png', sizes: '512x512', type: 'image/png' }
                        ]
                    });

                    // ×”×’×“×¨×ª ×¤×¢×•×œ×•×ª ×©×œ×™×˜×”
                    navigator.mediaSession.setActionHandler('play', () => {
                        playVideo();
                    });
                    navigator.mediaSession.setActionHandler('pause', () => {
                        pauseVideo();
                    });
                    navigator.mediaSession.setActionHandler('previoustrack', () => {
                        previousTrack();
                    });
                    navigator.mediaSession.setActionHandler('nexttrack', () => {
                        nextTrack();
                    });

                    console.log('âœ… Media Session API ××•×¤×¢×œ - × ×™×ª×Ÿ ×œ×©×œ×•×˜ ××”×¨×§×¢');
                } catch (e) {
                    console.warn('Media Session API ×œ× × ×ª××š:', e);
                }
            }
        }

        // ×¢×“×›×•×Ÿ ×©× ×”×©×™×¨ ×”× ×•×›×—×™
        function updateCurrentSong() {
            if (player && player.getVideoData) {
                try {
                    const videoData = player.getVideoData();
                    if (videoData && videoData.title) {
                        const adIndicator = isAdPlaying ? ' ğŸš« [××“×œ×’ ×¢×œ ×¤×¨×¡×•××ª...]' : '';
                        const title = videoData.title;
                        document.getElementById('currentSong').textContent = title + adIndicator;
                        
                        // ×¢×“×›×•×Ÿ Media Session
                        if (!isAdPlaying) {
                            updateMediaSession(title);
                        }
                    } else if (hasUserInteracted) {
                        document.getElementById('currentSong').textContent = '×œ× × ×™×ª×Ÿ ×œ×§×‘×œ ××™×“×¢ ×¢×œ ×”×©×™×¨';
                    }
                } catch (e) {
                    console.error('×©×’×™××” ×‘×§×‘×œ×ª ××™×“×¢ ×¢×œ ×”×©×™×¨:', e);
                }
            } else if (!hasUserInteracted) {
                document.getElementById('currentSong').textContent = '××•×›×Ÿ ×œ× ×’×Ÿ â€“ ×œ×—×¥ ×¢×œ â–¶ï¸ ×›×“×™ ×œ×”×ª×—×™×œ';
            }
        }

        function handlePlayerError(event) {
            const currentSongLabel = document.getElementById('currentSong');
            let message = '×œ× × ×™×ª×Ÿ ×œ× ×’×Ÿ ××ª ×”×©×™×¨ ×”× ×•×›×—×™.';

            switch (event.data) {
                case 2:
                    message = '×›×ª×•×‘×ª ×”×¡×¨×˜×•×Ÿ ×©×’×•×™×” ××• ×‘×œ×ª×™ ×–××™× ×”.';
                    break;
                case 5:
                    message = '×”×“×¤×“×¤×Ÿ ×œ× ×ª×•××š ×‘×¤×•×¨××˜ ×”×¡×¨×˜×•×Ÿ ×”× ×•×›×—×™.';
                    break;
                case 100:
                case 101:
                case 150:
                    message = '×”×¡×¨×˜×•×Ÿ ××•×’×‘×œ ×œ×¦×¤×™×™×” ×‘×ª×•×š YouTube ×‘×œ×‘×“.';
                    break;
            }

            currentSongLabel.textContent = message + ' ××“×œ×’ ×œ×©×™×¨ ×”×‘×...';

            if (player && player.nextVideo && hasUserInteracted) {
                setTimeout(() => {
                    try {
                        player.nextVideo();
                    } catch (err) {
                        console.error('× ×™×¡×™×•×Ÿ ××¢×‘×¨ ×œ×©×™×¨ ×”×‘× × ×›×©×œ:', err);
                    }
                }, 1500);
            }
        }
        
        // ×‘×“×™×§×” ××—×–×•×¨×™×ª ×©×œ ×©× ×”×©×™×¨ ×”× ×•×›×—×™
        setInterval(updateCurrentSong, 2000);
        
        // ×”×¤×¢×œ×ª ×× ×™×¢×ª ×›×™×‘×•×™ ××¡×š ×‘×˜×¢×™× ×ª ×”×“×£
        window.addEventListener('load', preventScreenSleep);
        
        // ×©×œ×™×˜×” ×‘×¢×•×¦××ª ×”×©××¢
        document.getElementById('volumeSlider').addEventListener('input', function() {
            if (player && player.setVolume) {
                const volume = this.value;
                player.setVolume(volume);
                updateVolumeIcon(volume);
                lastVolume = volume;
            }
        });
        
        // ×¢×“×›×•×Ÿ ××™×™×§×•×Ÿ ×”×¢×•×¦××” ×œ×¤×™ ×¢×¨×š ×”×¢×•×¦××”
        function updateVolumeIcon(volume) {
            const volumeIcon = document.getElementById('volumeIcon');
            if (volume == 0) {
                volumeIcon.textContent = 'ğŸ”‡'; // ××•×©×ª×§
            } else if (volume < 50) {
                volumeIcon.textContent = 'ğŸ”‰'; // ×¢×•×¦××” × ××•×›×”
            } else {
                volumeIcon.textContent = 'ğŸ”Š'; // ×¢×•×¦××” ×’×‘×•×”×”
            }
        }
        
        // ×¤×•× ×§×¦×™×” ×œ×”×©×ª×§×” ×•×”×¤×¢×œ×” ××—×“×© ×©×œ ×”×©××¢
        function toggleMute() {
            if (player && player.isMuted) {
                const volumeSlider = document.getElementById('volumeSlider');
                if (player.isMuted()) {
                    player.unMute();
                    volumeSlider.value = lastVolume;
                    updateVolumeIcon(lastVolume);
                } else {
                    player.mute();
                    updateVolumeIcon(0);
                }
            }
        }
        
        // ×ª××™×›×” ×‘×”×ª×§× ×ª PWA 
        window.addEventListener('beforeinstallprompt', (e) => {
            // ×× ×™×¢×ª ×”×¦×’×ª ×”×—×œ×•×Ÿ ×”××•×˜×•××˜×™
            e.preventDefault();
            // ×©××™×¨×ª ×”××™×¨×•×¢ ×›×“×™ ×©× ×•×›×œ ×œ×”×¤×¢×™×œ ××•×ª×• ×××•×—×¨ ×™×•×ª×¨
            deferredPrompt = e;
            
            // ×™×¦×™×¨×ª ×—×œ×•×Ÿ ××•×ª×× ×¢× ×”×•×“×¢×” ×œ×”×ª×§× ×”
            const installPrompt = document.createElement('div');
            installPrompt.className = 'install-prompt';
            installPrompt.innerHTML = `
                <button class="close-prompt" id="closePromptBtn">âœ–ï¸</button>
                <p>×¨×•×¦×” ×œ×”×ª×§×™×Ÿ ××ª × ×’×Ÿ ×”××•×–×™×§×” ×œ×¨×›×‘ ×™×©×™×¨×•×ª ×œ××¡×š ×”×‘×™×ª?</p>
                <button id="installBtn">×”×ª×§×Ÿ ×¢×›×©×™×•</button>
            `;
            document.body.appendChild(installPrompt);
            
            // ×”×¦×’×ª ×”×—×œ×•×Ÿ ×œ××—×¨ ×©× ×™×™×”
            setTimeout(() => {
                installPrompt.style.display = 'block';
            }, 1000);
            
            // ×”×•×¡×¤×ª ×××–×™×Ÿ ××™×¨×•×¢×™× ×œ×›×¤×ª×•×¨ ×”×¡×’×™×¨×”
            document.getElementById('closePromptBtn').addEventListener('click', () => {
                installPrompt.style.display = 'none';
            });
            
            // ×”×•×¡×¤×ª ×××–×™×Ÿ ××™×¨×•×¢×™× ×œ×›×¤×ª×•×¨ ×”×”×ª×§× ×”
            document.getElementById('installBtn').addEventListener('click', async () => {
                // ×”×¡×ª×¨×ª ×”×—×œ×•×Ÿ
                installPrompt.style.display = 'none';
                
                // ×”×¦×’×ª ×—×œ×•×Ÿ ×”×”×ª×§× ×”
                deferredPrompt.prompt();
                
                // ×‘×“×™×§×” ×× ×”××©×ª××© ××™×©×¨ ××ª ×”×”×ª×§× ×”
                const { outcome } = await deferredPrompt.userChoice;
                
                // ××™×¤×•×¡ deferredPrompt ×›×™ × ×™×ª×Ÿ ×œ×”×©×ª××© ×‘×• ×¨×§ ×¤×¢× ××—×ª
                deferredPrompt = null;
            });
        });
        
        // ×× ×”××¤×œ×™×§×¦×™×” ×›×‘×¨ ××•×ª×§× ×ª
        window.addEventListener('appinstalled', () => {
            // ×”×¡×ª×¨×ª ×”×›×¤×ª×•×¨ ×× ×”×•× ×¢×“×™×™×Ÿ ××•×¦×’
            const installPrompt = document.querySelector('.install-prompt');
            if (installPrompt) {
                installPrompt.style.display = 'none';
            }
            deferredPrompt = null;
        });

        // ×× ×’× ×•×Ÿ ×©××™×¨×” ×¢×œ ×”××¤×œ×™×§×¦×™×” ×¤×¢×™×œ×” ×‘×¨×§×¢
        function keepAppAlive() {
            // 1. Page Lifecycle API - ×× ×™×¢×ª freeze/discard ×‘×× ×“×¨×•××™×“
            if ('onfreeze' in document) {
                document.addEventListener('freeze', (e) => {
                    console.log('â„ï¸ ×× ×“×¨×•××™×“ ×× ×¡×” ×œ×”×§×¤×™× - ××•× ×¢!');
                    e.preventDefault();
                });
            }
            
            if ('onresume' in document) {
                document.addEventListener('resume', () => {
                    console.log('â™»ï¸ ×”××¤×œ×™×§×¦×™×” ×—×•×“×©×”');
                    // ×•×•×“× ×©×”× ×’×Ÿ ×¢×“×™×™×Ÿ ×¤×¢×™×œ
                    if (player && player.getPlayerState && player.getPlayerState() === 2) {
                        player.playVideo();
                    }
                });
            }

            // 2. ×× ×™×¢×ª ×”×©×”×™×”/×¡×’×™×¨×” ×©×œ ×”×“×£
            let backgroundNotificationShown = false;
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    console.log('ğŸ“± ×”××¤×œ×™×§×¦×™×” ×¢×‘×¨×” ×œ×¨×§×¢ - ×©×•××¨ ×¢×œ ×¤×¢×™×œ×•×ª');
                    // ×”××©×š × ×™×’×•×Ÿ ×’× ×‘×¨×§×¢
                    if (player && player.getPlayerState && player.getPlayerState() === 1) {
                        console.log('ğŸµ ×××©×™×š ×œ× ×’×Ÿ ×‘×¨×§×¢');
                        
                        // ×”×¦×’ ×”×•×“×¢×” ×œ××©×ª××© ×¤×¢× ××—×ª
                        if (!backgroundNotificationShown && 'Notification' in window && Notification.permission === 'granted') {
                            new Notification('ğŸµ × ×’×Ÿ ××•×–×™×§×” ×œ×¨×›×‘', {
                                body: '×”××•×–×™×§×” ×××©×™×›×” ×œ× ×’×Ÿ ×‘×¨×§×¢ ğŸš—',
                                icon: 'car-music-icon.png',
                                tag: 'background-music',
                                requireInteraction: false
                            });
                            backgroundNotificationShown = true;
                        }
                    }
                } else {
                    console.log('ğŸ“± ×”××¤×œ×™×§×¦×™×” ×—×–×¨×” ×œ×—×–×™×ª');
                    // ×•×•×“× ×©×”× ×’×Ÿ ×¢×“×™×™×Ÿ ×¢×•×‘×“
                    if (player && player.getPlayerState) {
                        const state = player.getPlayerState();
                        console.log('ğŸ” ××¦×‘ × ×’×Ÿ:', state);
                    }
                }
            });

            // 2. ×× ×™×¢×ª unload/beforeunload
            window.addEventListener('beforeunload', (e) => {
                // ××•× ×¢ ×¡×’×™×¨×” ××§×¨×™×ª
                if (player && player.getPlayerState && player.getPlayerState() === 1) {
                    e.preventDefault();
                    e.returnValue = '';
                    return '';
                }
            });

            // 3. ×©××™×¨×” ×¢×œ ×—×™×‘×•×¨ ×¤×¢×™×œ - heartbeat
            let heartbeatInterval = setInterval(() => {
                if (document.hidden && player && player.getPlayerState) {
                    // ×©×œ×™×—×ª "×“×•×¤×§" ×›×“×™ ×œ×©××•×¨ ×¢×œ ×”××¤×œ×™×§×¦×™×” ×—×™×”
                    try {
                        const state = player.getPlayerState();
                        console.log('ğŸ’“ Heartbeat - ××¦×‘ × ×’×Ÿ:', state);
                    } catch (e) {
                        // ×©×§×˜
                    }
                }
            }, 5000); // ×›×œ 5 ×©× ×™×•×ª

            // 4. ×× ×™×¢×ª sleep mode
            if ('wakeLock' in navigator) {
                let wakeLock = null;
                const requestWakeLock = async () => {
                    try {
                        wakeLock = await navigator.wakeLock.request('screen');
                        console.log('ğŸ”’ Wake Lock ×¤×¢×™×œ - ××•× ×¢ ×›×™×‘×•×™');
                        
                        wakeLock.addEventListener('release', () => {
                            console.log('ğŸ”“ Wake Lock ×©×•×—×¨×¨ - ×× ×¡×” ×©×•×‘');
                            setTimeout(requestWakeLock, 1000);
                        });
                    } catch (err) {
                        console.log('âš ï¸ Wake Lock × ×›×©×œ, ×× ×¡×” ×©×•×‘ ×‘×¢×•×“ 5 ×©× ×™×•×ª');
                        setTimeout(requestWakeLock, 5000);
                    }
                };
                
                // ×”×¤×¢×œ×” ×¨××©×•× ×™×ª
                requestWakeLock();
                
                // ×”×¤×¢×œ×” ××—×“×© ×›×©×—×•×–×¨×™× ××¨×§×¢
                document.addEventListener('visibilitychange', () => {
                    if (!document.hidden && wakeLock === null) {
                        requestWakeLock();
                    }
                });
            }

            // 5. ×©××™×¨×” ×¢×œ Audio Context ×¤×¢×™×œ (×—×©×•×‘ ×œ× ×™×’×•×Ÿ ×‘×¨×§×¢)
            if ('AudioContext' in window || 'webkitAudioContext' in window) {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                const audioContext = new AudioContext();
                
                // ×©××™×¨×” ×¢×œ ×”-context ×¤×¢×™×œ
                setInterval(() => {
                    if (audioContext.state === 'suspended') {
                        audioContext.resume().then(() => {
                            console.log('ğŸ”Š Audio Context ×—×•×“×©');
                        });
                    }
                }, 3000);
            }

            // 6. ×× ×™×¢×ª "freeze" ×‘-iOS
            if (/iPhone|iPad|iPod/.test(navigator.userAgent)) {
                // iOS ×“×•×¨×© ×¤×¢×™×œ×•×ª ×§×‘×•×¢×”
                setInterval(() => {
                    if (document.hidden) {
                        // ×¤×¢×•×œ×” ×§×˜× ×” ×©××•× ×¢×ª freeze
                        const dummy = new Date().getTime();
                    }
                }, 1000);
            }

            // 7. ×©××™×¨×” ×¢×œ Service Worker ×¤×¢×™×œ (×× ×§×™×™×)
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.ready.then(registration => {
                    console.log('âœ… Service Worker ××•×›×Ÿ ×œ×¢×‘×•×“×” ×‘×¨×§×¢');
                    
                    // ×©×œ×™×—×ª ×”×•×“×¢×•×ª ×ª×§×•×¤×ª×™×•×ª ×œ-Service Worker
                    setInterval(() => {
                        if (registration.active) {
                            registration.active.postMessage({
                                type: 'KEEP_ALIVE',
                                timestamp: Date.now()
                            });
                        }
                    }, 10000);
                });
            }

            // 8. ×‘×§×©×ª ×”×¨×©××•×ª ×œ×”×ª×¨××•×ª (×œ××—×¨ ××™× ×˜×¨××§×¦×™×” ×¨××©×•× ×”)
            if ('Notification' in window && Notification.permission === 'default') {
                // × ×‘×§×© ×”×¨×©××” ×¨×§ ××—×¨×™ ×©×”××©×ª××© ×œ×—×¥ play
                const requestNotificationPermission = () => {
                    if (hasUserInteracted) {
                        Notification.requestPermission().then(permission => {
                            if (permission === 'granted') {
                                console.log('âœ… ×”×¨×©××•×ª ×”×ª×¨××•×ª × ×™×ª× ×•');
                            }
                        });
                        // ×”×¡×¨ ××ª ×”×××–×™×Ÿ ××—×¨×™ ×‘×§×©×” ××—×ª
                        document.removeEventListener('click', requestNotificationPermission);
                    }
                };
                document.addEventListener('click', requestNotificationPermission);
            }

            console.log('ğŸ›¡ï¸ ×× ×’× ×•× ×™ ×©××™×¨×” ×¢×œ ×¤×¢×™×œ×•×ª ×‘×¨×§×¢ ×”×•×¤×¢×œ×•');
        }

        // ×”×¤×¢×œ×ª ×× ×’× ×•× ×™ ×©××™×¨×” ×¢×œ ×¤×¢×™×œ×•×ª
        window.addEventListener('load', keepAppAlive);
        
        // ×§×™×¦×•×¨×™ ××§×œ×“×ª ×œ××—×©×‘
        document.addEventListener('keydown', function(event) {
            // ×× ×”××©×ª××© ××§×œ×™×“ ×‘×©×“×” ×˜×§×¡×˜, ×œ× ×œ×”×¤×¢×™×œ ×§×™×¦×•×¨×™×
            if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') {
                return;
            }
            
            switch(event.key) {
                case ' ': // ×¨×•×•×— - ×”×¤×¢×œ×”/×”×©×”×™×™×”
                    if (player && player.getPlayerState) {
                        if (player.getPlayerState() === YT.PlayerState.PLAYING) {
                            pauseVideo();
                        } else {
                            playVideo();
                        }
                    }
                    event.preventDefault();
                    break;
                case 'ArrowRight': // ×—×¥ ×™××™× ×” - ×©×™×¨ ×”×‘×
                    nextTrack();
                    event.preventDefault();
                    break;
                case 'ArrowLeft': // ×—×¥ ×©×××œ×” - ×©×™×¨ ×§×•×“×
                    previousTrack();
                    event.preventDefault();
                    break;
                case 's': // ×¢×¨×‘×•×‘
                case 'S':
                    toggleShuffle();
                    event.preventDefault();
                    break;
                case 'p': // ×¤×œ×™×™×œ×™×¡×˜ ×”×‘×
                case 'P':
                    nextPlaylist();
                    event.preventDefault();
                    break;
                case 'm': // ×”×©×ª×§×”
                case 'M':
                    toggleMute();
                    event.preventDefault();
                    break;
                case 'd': // ××¦×‘ ×™×•×/×œ×™×œ×”
                case 'D':
                    toggleDayNightMode();
                    event.preventDefault();
                    break;
                case '+': // ×”×’×‘×¨×ª ×¢×•×¦××”
                case '=':
                    if (player && player.getVolume) {
                        const currentVolume = player.getVolume();
                        const newVolume = Math.min(100, currentVolume + 10);
                        player.setVolume(newVolume);
                        document.getElementById('volumeSlider').value = newVolume;
                        updateVolumeIcon(newVolume);
                    }
                    event.preventDefault();
                    break;
                case '-': // ×”× ××›×ª ×¢×•×¦××”
                case '_':
                    if (player && player.getVolume) {
                        const currentVolume = player.getVolume();
                        const newVolume = Math.max(0, currentVolume - 10);
                        player.setVolume(newVolume);
                        document.getElementById('volumeSlider').value = newVolume;
                        updateVolumeIcon(newVolume);
                    }
                    event.preventDefault();
                    break;
            }
        });
        
        // ×”×¦×’×ª ×•×”×¡×ª×¨×ª ×§×™×¦×•×¨×™ ××§×œ×“×ª ×‘×”×ª×× ×œ×¡×•×’ ×”××›×©×™×¨
        function checkDeviceType() {
            // ×¤×•× ×§×¦×™×” ××©×•××¨×ª ××š ×œ× ×¢×•×©×” ×›×œ×•× ×›×¨×’×¢ ×›×™×•×•×Ÿ ×©×”×¡×¨× ×• ××ª ×§×™×¦×•×¨×™ ×”××§×œ×“×ª
            // ××•×©××¨×ª ×œ×©×™××•×© ×¢×ª×™×“×™
        }
        
        // ×‘×“×™×§×ª ×¡×•×’ ×”××›×©×™×¨ ×‘×˜×¢×™× ×”
        window.addEventListener('load', checkDeviceType);
        
        // ×¨×™×©×•× Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('âœ… Service Worker × ×¨×©× ×‘×”×¦×œ×—×”:', registration.scope);
                        
                        // ×‘×“×™×§×” ×× ×™×© ×¢×“×›×•×Ÿ
                        registration.addEventListener('updatefound', () => {
                            console.log('ğŸ”„ × ××¦× ×¢×“×›×•×Ÿ ×œ-Service Worker');
                        });
                    })
                    .catch(error => {
                        console.error('âŒ ×¨×™×©×•× Service Worker × ×›×©×œ:', error);
                    });
            });
        }

        // ×‘×“×™×§×ª ×˜×¢×™× ×ª ×”×“×£ ×•××¦×‘ ×”× ×’×Ÿ
        window.addEventListener('load', function() {
            console.log('×”×“×£ × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”');
            
            // ×¢×“×›×•×Ÿ ×›×¤×ª×•×¨×™ × ×™×•×•×˜ ×¤×œ×™×™×œ×™×¡×˜×™×
            updatePlaylistNavigation();
            
            // ×‘×“×™×§×” ×©×›×œ ×”××œ×× ×˜×™× ××•×¦×’×™×
            setTimeout(function() {
                // ×•×™×“×•× ×©×›×œ ×”××œ×× ×˜×™× ××•×¦×’×™× ×‘×¦×•×¨×” ×ª×§×™× ×”
                document.getElementById('currentSongContainer').style.display = 'block';
                document.getElementById('volumeControl').style.display = 'flex';
                document.querySelectorAll('.control-buttons').forEach(el => el.style.display = 'flex');
                document.getElementById('playlistName').style.display = 'block';
                
                // ×× ×’× ×•×Ÿ ×‘×“×™×§×” ×•×ª×™×§×•×Ÿ ×× ×”× ×’×Ÿ ×œ× × ×˜×¢×Ÿ ×›×¨××•×™
                if (!player || (player && typeof player.getPlayerState !== 'function')) {
                    console.log('× ×’×Ÿ YouTube ×œ× × ×˜×¢×Ÿ ×›×¨××•×™, ×× ×¡×” ×œ×˜×¢×•×Ÿ ××—×“×©...');
                    // × ×™×¡×™×•×Ÿ ×œ×˜×¢×•×Ÿ ××—×“×© ××ª ×”× ×’×Ÿ ×‘×¦×•×¨×” ×™×©×™×¨×” ×•×¤×©×•×˜×”
                    document.getElementById('player').innerHTML = '<iframe width="100%" height="350" src="https://www.youtube.com/embed/videoseries?list=' + 
                        playlists[currentPlaylistIndex].id + 
                        '&autoplay=0&rel=0&modestbranding=1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>';
                }
            }, 1000); // ×‘×“×™×§×” ×œ××—×¨ ×©× ×™×™×” ××—×ª
        });
    </script>

</body>
</html>